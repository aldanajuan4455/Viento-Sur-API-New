{% extends 'VientoSurAppAppBundle::layoutHotel.html.twig' %}

{% block content %}
    <div class="container formBooking">
        <div class="row">
            <div class="gap"></div>
            <div class="col-md-3">
                <div class="content-sidebar">
                    <div class="booking-item-dates-change mb5">
                        <h2>Detalle de su pago</h2>
                        Habitación por noche:
                        {#{{price_detail.taxes}}#} {{ price_detail.nightly.subtotal }}<br>
                        detalle impuestos: <br>
                        {% for taxes_detail in price_detail.taxes_detail %}
                            codigo/ {{ taxes_detail.code }}
                            cantidad/{{ taxes_detail.amount }}<br>
                        {% endfor %}
                        cuota(fee): {{ price_detail.fee }}<br>
                        Descuentos : {{ price_detail.discounts }}<br>
                        subtotal :{{ price_detail.subtotal }}<br>
                        total: {{ price_detail.total }}<br>
                    </div>
                    {% include 'VientoSurAppAppBundle:Hotel:searchMenuLeft.html.twig' %}

                </div>
            </div>
            <div class="col-md-9">
                {{ form_start(formNewPay) }}

                <!--Pasajeros-->
                <div class="panel panel-primary">
                    <div class="panel-heading">Titular de habitación</div>
                    <div class="panel-body">
                        {#{{ form_row(formNewPay.passengers) }}#}
                        {% for passenger in formChoice.passengers %}
                            {% if loop.index0 > 0 %}
                                <hr/>
                            {% endif %}
                            {% set temp = attribute(rooms, loop.index0) %}
                            <h5>Habitación {{ loop.index }}: {{ temp.name }}</h5>

                            <div class="row">
                                <div class="col-md-4">
                                    {% set fieldName = 'first_name' ~ loop.index0 %}
                                    {{ form_row(attribute(formNewPay.passengers, fieldName), {'label': 'Nombre(s):', 'attr': {'placeholder': 'Como aparece en el documento'}}) }}
                                </div>
                                <div class="col-md-4">
                                    {% set fieldName = 'last_name' ~ loop.index0 %}
                                    {{ form_row(attribute(formNewPay.passengers, fieldName), {'label': 'Apellido(s):', 'attr': {'placeholder': 'Como aparece en el documento'}}) }}
                                </div>
                                <div class="col-md-4">
                                    {% set fieldName = 'document_number' ~ loop.index0 %}
                                    {{ form_row(attribute(formNewPay.passengers, fieldName), {'label': 'Documento de Identidad:'}) }}
                                </div>
                            </div>
                            {% set fieldName = 'room_reference' ~ loop.index0 %}
                            {{ form_widget(attribute(formNewPay.passengers, fieldName), { 'attr': {'class': 'hidden-row'} }) }}
                        {% endfor %}
                        {{ form_widget(formNewPay.passengers.idspecial_requests, { 'attr': {'class': 'hidden-row'} }) }}
                        {{ form_widget(formNewPay.passengers.paramsspecial_requests, { 'attr': {'class': 'hidden-row'} }) }}
                    </div>
                </div>
                <!--/Pasajeros-->

                <!--Formas de pago-->
                <div class="panel panel-primary">
                    <div class="panel-heading">Formas de pago</div>
                    <div class="panel-body">
                        <ul class="list-group">
                            {% for paymentMethod in paymentMethods %}
                                <li class="list-group-item">
                                    <div class="radio">
                                        <label>
                                            {#{% if loop.index0 == 0 %}#}
                                            {#<input type="radio" name="paymentMethodChoice" value="{{ paymentMethod.choice }}" checked="checked">#}
                                            {#{% else %}#}
                                            {#<input type="radio" name="paymentMethodChoice" value="{{ paymentMethod.choice }}">#}
                                            {#{% endif %}#}

                                            {{ form_widget(attribute(formNewPay.payment.paymentMethod, loop.index0)) }}
                                        </label>
                                        {% if paymentMethod.type == 'at_destination' %}
                                            <p>Pago al Hotel</p>
                                        {% else %}
                                            {{ paymentMethod.type }}
                                        {% endif %}

                                        <div class="card-list">
                                            {% for cardId in paymentMethod.card_ids %}
                                                <label class="card-selector">
                                                    {% set cardData = cardId|split('-') %}
                                                    <div class="eva-card-container" data-card-id="{{ cardId }}">
                                                        <span class="eva-card-body {{ cardData[1] }}"></span>
                                                    </div>
                                                </label>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </li>
                            {% endfor %}
                            <hr/>
                        </ul>

                        {% if formChoice.payment.credit_card is defined %}
                            <hr/>
                            <h3>Medio de pago:</h3>
                            <div class="row">
                                <div class="col-md-3">
                                    <label>Tarjeta:</label>
                                    <input type="text" value="" id="card-selected" readonly>
                                </div>
                                <div class="col-md-3">
                                    {{ form_row(formNewPay.payment.number, {'label': 'Número de tarjeta:'}) }}
                                </div>
                                <div class="col-md-3">
                                    {{ form_row(formNewPay.payment.expiration, {'label': 'Vencimiento:'}) }}
                                </div>
                                <div class="col-md-3">
                                    {{ form_row(formNewPay.payment.security_code, {'label': 'Código de seguridad:'}) }}
                                </div>
                            </div>

                            <div class="row">
                                {% if formNewPay.payment.owner_name is defined %}
                                    <div class="col-md-3">
                                        {{ form_row(formNewPay.payment.owner_name, {'label': 'Titular de la tarjeta:', 'attr': {'placeholder': 'Como aparece en la tarjeta'}}) }}
                                    </div>
                                {% endif %}

                                {% if formNewPay.payment.owner_document is defined %}
                                    <div class="col-md-3">
                                        {{ form_row(formNewPay.payment.owner_document, {'label': 'Documento de Identidad del titular:'}) }}
                                    </div>
                                {% endif %}

                                {% if formNewPay.payment.owner_documenttype is defined %}
                                    <div class="col-md-3">
                                        {{ form_row(formNewPay.payment.owner_documenttype, {'label': 'Tipo de documento:'}) }}
                                    </div>
                                {% endif %}

                                {% if formNewPay.payment.owner_documentnumber is defined %}
                                    <div class="col-md-3">
                                        {{ form_row(formNewPay.payment.owner_documentnumber, {'label': 'Nro. de documento:'}) }}
                                    </div>
                                {% endif %}

                                {% if formNewPay.payment.owner_gender is defined %}
                                    <div class="col-md-3">
                                        {{ form_row(formNewPay.payment.owner_gender, {'label': 'Género:'}) }}
                                    </div>
                                {% endif %}
                            </div>
                            {{ form_widget(formNewPay.payment.bank_code, { 'attr': {'class': 'hidden-row'} }) }}
                            {{ form_widget(formNewPay.payment.card_code, { 'attr': {'class': 'hidden-row'} }) }}
                            {{ form_widget(formNewPay.payment.card_type, { 'attr': {'class': 'hidden-row'} }) }}
                        {% endif %}

                        {% if formChoice.payment.invoice is defined %}
                            {% include 'VientoSurAppAppBundle:Hotel:bookingHotelPayInvoice.html.twig' %}
                        {% endif %}
                    </div>
                </div>
                <!--/Formas de pago-->

                <!--Contacto-->
                <div class="panel panel-primary">
                    <div class="panel-heading">Datos de Contacto</div>
                    <div class="panel-body">
                        {#{{ form_row(formNewPay.contact) }}#}
                        <div class="row">
                            {% for phone in formChoice.contact.phones %}
                                <div class="col-md-2">
                                    {% set fieldName = 'country_code' ~ loop.index0 %}
                                    {{ form_row(attribute(formNewPay.contact, fieldName), {'label': 'Código de país:'}) }}
                                </div>

                                {% set fieldName = 'area_code' ~ loop.index0 %}
                                {% if attribute(formNewPay.contact, fieldName) is defined %}
                                    <div class="col-md-2">
                                        {{ form_row(attribute(formNewPay.contact, fieldName), {'label': 'Código de área:'}) }}
                                    </div>
                                {% endif %}

                                <div class="col-md-2">
                                    {% set fieldName = 'number' ~ loop.index0 %}
                                    {{ form_row(attribute(formNewPay.contact, fieldName), {'label': 'Número:'}) }}
                                </div>

                                {% set fieldName = 'type' ~ loop.index0 %}
                                {% if attribute(formNewPay.contact, fieldName) is defined %}
                                    <div class="col-md-2">
                                        {{ form_row(attribute(formNewPay.contact, fieldName), {'label': 'Tipo:'}) }}
                                    </div>
                                {% endif %}
                            {% endfor %}
                            <div class="col-md-2">
                                {{ form_row(formNewPay.contact.email, {'label': 'Email:'}) }}
                            </div>
                        </div>
                    </div>
                </div>
                <!--/Contacto-->

                <!--Vouchers-->
                {% if formNewPay.vouchers is defined %}
                    <div class="panel panel-primary">
                        <div class="panel-heading">Cupones</div>
                        <div class="panel-body">
                            {#{{ form_row(formNewPay.vouchers) }}#}
                            <div class="row">
                                {% for voucher in formChoice.vouchers %}
                                    <div class="col-md-2">
                                        {% set fieldName = loop.index0 %}
                                        {{ form_row(attribute(formNewPay.vouchers, fieldName), {'label': 'Cupón:'}) }}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                <!--/Vouchers-->

                <!--Datos adicionales-->
                {% if formNewPay.additionalData is defined %}
                    <div class="panel panel-primary">
                        <div class="panel-heading">Datos adicionales</div>
                        <div class="panel-body">
                            {#{{ form_row(formNewPay.additionalData) }}#}
                            <div class="row">
                                {% if formNewPay.additionalData.comment is defined %}
                                    <div class="col-md-2">
                                        {{ form_row(formNewPay.additionalData.comment, {'label': 'Comentarios:'}) }}
                                    </div>
                                {% endif %}

                                {% if formNewPay.additionalData.subscribe_newsletter is defined %}
                                    <div class="col-md-2">
                                        {{ form_row(formNewPay.additionalData.subscribe_newsletter, {'label': 'Subscribir a noticias:'}) }}
                                    </div>
                                {% endif %}

                                {% if formNewPay.additionalData.travel_assistance is defined %}
                                    <div class="col-md-2">
                                        {{ form_row(formNewPay.additionalData.travel_assistance, {'label': 'Asistencia en viaje:'}) }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                <!--/Datos adicionales-->

                <div class="gap"></div>
                <div class="mod-searchbutton">
                    <button class="btn btn-primary btn-lg" type="submit">Comprar</button>
                    <span>Por favor, antes de finalizar, revise los datos ingresados.</span>
                </div>
                <input type="hidden" name="roompack_choice" value="{{ roompack_choice }}">
                {{ form_rest(formNewPay) }}
                {{ form_end(formNewPay) }}
            </div>
            <div class="gap"></div>
            {{ dump(formNewPay) }}
            {{ dump(formChoice) }}
            {{ dump(paymentMethods) }}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $('#form_payment_expiration_day').hide();

        $(document).ready(function () {
            var cardsObject = {
                'VI': 'Visa',
                'CA': 'MasterCard',
                'AX': 'American Express',
                'DC': 'Diners Club',
                'CL': 'Cabal',
                'TN': 'Tarjeta Naranja',
                'NV': 'Tarjeta Nevada'
            };
            $('.eva-card-container:first').addClass('selected-p-card');
            var cardId = $('.eva-card-container:first').attr('data-card-id');
            $('#form_payment_bank_code').val(cardId);
            var splitCard = cardId.split("-");
            $('#form_payment_card_code').val(splitCard[1]);
            $('#form_payment_card_type').val(splitCard[3]);
            $('#card-selected').val(cardsObject[splitCard[1]]);

            $('.eva-card-container').on('click', function () {
                $('.card-list .eva-card-container').removeClass('selected-p-card');
                var cardId = $(this).attr('data-card-id');
                $('#form_payment_bank_code').val(cardId);
                $(this).addClass('selected-p-card');
                var splitCard = cardId.split("-");
                $('#form_payment_card_code').val(splitCard[1]);
                $('#form_payment_card_type').val(splitCard[3]);
                $('#card-selected').val(cardsObject[splitCard[1]]);
            });

            ////
            var ac = $('#autocomplete-city').autocomplete({
                serviceUrl: Routing.generate('city_autocomplete'),
                onSelect: function (suggestion) {
                    $("#form_payment_billing_addresscity_id").val(suggestion.data);
                    $("#form_payment_billing_addresscity_id").data('name', suggestion.value);
                },
                onInvalidateSelection: function () {
                    $("#form_payment_billing_addresscity_id").val('');
                },
                minChars: 3
            });

            $("#autocomplete-state").autocomplete({
                serviceUrl: Routing.generate('state_autocomplete'),
                onSelect: function (suggestion) {
                    $("#form_payment_billing_addressstate_id").val(suggestion.data);
                    $("#form_payment_billing_addressstate_id").data('name', suggestion.value);
                    $('#autocomplete-city').removeProp('readonly').prop('placeholder', 'Buscar ciudad');
                    $('#autocomplete-city').autocomplete().setOptions({
                        serviceUrl: Routing.generate('city_autocomplete') + '/' + suggestion.data
                    });
                },
                onInvalidateSelection: function () {
                    $("#form_payment_billing_addressstate_id, #form_payment_billing_addresscity_id").val('');
                    $('#autocomplete-city').prop('readonly');
                    $('#autocomplete-city').prop('placeholder', 'Rellene la provincia');
                },
                minChars: 3
            });



            $('#autocomplete-state, #autocomplete-city').on("click", function () {
                $(this).select();
            });
        });
    </script>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style type="text/css">
        .credit-card-div span {
            padding-top: 10px;
        }

        .credit-card-div img {
            padding-top: 30px;
        }

        .credit-card-div .small-font {
            font-size: 9px;
        }

        .credit-card-div .pad-adjust {
            padding-top: 10px;
        }

        .hidden-row {
            display: none;
        }

        .selected-p-card {
            border: 1px solid #1beab2 !important;
        }

        .eva-card-container:hover {
            border: 1px solid #1beab2 !important;
        }

        .card-list {
            font-size: 0;
            position: relative;
            text-align: right;
        }

        .installment-data {
            width: 50%;
            position: relative;
            float: left;
        }

        .card-list .eva-card-container {
            margin-left: 3px;
            margin-bottom: 5px;
        }

    </style>
    <link href="{{ asset('css/cards-horizontal.css') }}" rel="stylesheet" type="text/css"/>
{% endblock %}